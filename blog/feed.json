{
  "version": "https://jsonfeed.org/version/1",
  "title": "The espadrine blog.",
  "description": "Tech deep dives, discoveries, and analyses.",
  "home_page_url": "https://espadrine.github.io/blog/",
  "feed_url": "https://espadrine.github.io/blog/feed.json",
  "author": {
    "name": "ThaddÃ©e Tyl",
    "url": "https://github.com/espadrine"
  },
  "favicon": "https://avatars.githubusercontent.com/u/100689?s=64",
  "items": [
      {
        "id":  "https://espadrine.github.io/blog/posts/faster-wordle-estimators.html",
        "url": "https://espadrine.github.io/blog/posts/faster-wordle-estimators.html",
        "title": "Faster Wordle Estimators",
        "tags": "ml julia optimization",
        "date_published": "2024-02-17T10:24:32Z"
        "content_html": "<h1 id=\"Faster_Wordle_Estimators\">Faster Wordle Estimators <a href=\"#Faster_Wordle_Estimators\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h1>\n<p>Two years ago, the game of <a href=\"https://www.nytimes.com/games/wordle/index.html\">Wordle</a> was released.\nI wrote <a href=\"https://espadrine.github.io/blog/posts/sometimes-rewriting-in-another-language-works.html\">an article back then on finding good words to solve it</a>,\nbut I focused on implementing a good-enough algorithm,\nwhich was a bit slow, and switched programming language\ntrying to tame its speed. I ended it saying: â€œAlgorithms do matter too.â€</p>\n<p>It would be nice if, instead of language-specific tweaks,\nwe found an algorithm that made the runtime plummet\nfrom half an hour to a second.</p>\n<p>It would be nicer if we created an algorithm that achieved perfect play.</p>\n<p>It would be even neater if that algorithm was so generic,\nthat it could solve a whole class of similar games.</p>\n<h2 id=\"From_formula_to_approximation\">From formula to approximation <a href=\"#From_formula_to_approximation\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h2>\n<h3 id=\"Statistical\">Statistical <a href=\"#Statistical\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h3>\n<p>The strategy we left off in the previous article had merit:\nit computed the average number of possible solutions left over\nafter making a particular guess.\nGiven the set of solutions <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">S</mi></mrow><annotation encoding=\"application/x-tex\">\\mathscr{S}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span></span></span></span>, we compute for each guess <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span>:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"script\">R</mi><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo><mo><mover><mo><mo>=</mo></mo><mtext>def</mtext></mover></mo><mfrac><mrow><munder><mo>âˆ‘</mo><mrow><mi>s</mi><mo>âˆˆ</mo><mi mathvariant=\"script\">S</mi></mrow></munder><mi mathvariant=\"normal\">âˆ£</mi><mo stretchy=\"false\">{</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">â€²</mo></msup><mi mathvariant=\"normal\">âˆ£</mi><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">â€²</mo></msup><mo>âˆˆ</mo><mi mathvariant=\"script\">S</mi><mo separator=\"true\">,</mo><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">â€²</mo></msup><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">}</mo><mi mathvariant=\"normal\">âˆ£</mi></mrow><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\mathscr{R}(g) \\stackrel{\\text{def}}{=} \\frac{ \\sum_{s \\in \\mathscr{S}} |\\{s&#x27;|s&#x27; \\in \\mathscr{S}, \\mathscr{C}(s&#x27;|g)=\\mathscr{C}(s|g)\\}| }{|\\mathscr{S}|}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.402978em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.06259em;\">R</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mop op-limits\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.152978em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">=</span></span></span><span style=\"top:-3.5668699999999998em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">def</span></span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.404972em;vertical-align:-0.936em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.468972em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.71708em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.19189em;\">S</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">âˆ£</span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">â€²</span></span></span></span></span></span></span></span></span><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">â€²</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">âˆˆ</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">â€²</span></span></span></span></span></span></span></span></span><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mclose\">}</span><span class=\"mord\">âˆ£</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>\n<p>where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathscr{C}(s|g)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span></span></span></span> is the constraint that Wordle unveils\nif the secret solution is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span> and the guessed word is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span>.\nFor instance, if the secret word is â€œcraftâ€,\nand we input the guess â€œsaletâ€, Wordle will yield\nthe constraint â¬›ğŸŸ¨â¬›â¬›ğŸŸ© (second letter misplaced,\nlast letter correct, other letters absent from the secret word).</p>\n<p>We can rephrase the formula using the Iverson bracket\n(which is 1 if the condition is true, 0 otherwise):</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"script\">R</mi><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><munder><mo>âˆ‘</mo><mrow><mi>s</mi><mo>âˆˆ</mo><mi mathvariant=\"script\">S</mi></mrow></munder><munder><mo>âˆ‘</mo><mrow><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">â€²</mo></msup><mo>âˆˆ</mo><mi mathvariant=\"script\">S</mi></mrow></munder><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ¦</mo><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">â€²</mo></msup><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ§</mo></mrow><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\mathscr{R}(g) = \\frac{ \\sum_{s \\in \\mathscr{S}} \\sum_{s&#x27; \\in \\mathscr{S}} âŸ¦\\mathscr{C}(s&#x27;|g)=\\mathscr{C}(s|g)âŸ§ }{|\\mathscr{S}|}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.06259em;\">R</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.404972em;vertical-align:-0.936em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.468972em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.71708em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.19189em;\">S</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6828285714285715em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">â€²</span></span></span></span></span></span></span></span></span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.19189em;\">S</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mopen\"><span class=\"mopen\">[</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mopen\">[</span></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">â€²</span></span></span></span></span></span></span></span></span><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mclose\">]</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>\n<p>Letâ€™s now do a magic trick.\nWe can insert a sum over constraints\n(defining <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathscr{C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span></span></span></span> as the set of constraints)\nif that sum only contains a single term.\nIt is the case below,\nsince a guess always produces the same constraint for a given solution:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"script\">R</mi><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><munder><mo>âˆ‘</mo><mrow><mi>s</mi><mo>âˆˆ</mo><mi mathvariant=\"script\">S</mi></mrow></munder><munder><mo>âˆ‘</mo><mrow><mi>c</mi><mo>âˆˆ</mo><mi mathvariant=\"script\">C</mi></mrow></munder><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ¦</mo><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>c</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ§</mo><munder><mo>âˆ‘</mo><mrow><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">â€²</mo></msup><mo>âˆˆ</mo><mi mathvariant=\"script\">S</mi></mrow></munder><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ¦</mo><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">â€²</mo></msup><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ§</mo></mrow><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\mathscr{R}(g) = \\frac{ \\sum_{s \\in \\mathscr{S}} \\sum_{c \\in \\mathscr{C}} âŸ¦\\mathscr{C}(s|g)=câŸ§ \\sum_{s&#x27; \\in \\mathscr{S}} âŸ¦\\mathscr{C}(s&#x27;|g)=\\mathscr{C}(s|g)âŸ§ }{|\\mathscr{S}|}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.06259em;\">R</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.404972em;vertical-align:-0.936em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.468972em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.71708em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.19189em;\">S</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.1689em;\">C</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mopen\"><span class=\"mopen\">[</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mopen\">[</span></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\"><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mclose\">]</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6828285714285715em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">â€²</span></span></span></span></span></span></span></span></span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.19189em;\">S</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mopen\"><span class=\"mopen\">[</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mopen\">[</span></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">â€²</span></span></span></span></span></span></span></span></span><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mclose\">]</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>\n<p>We can now swap the summations:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"script\">R</mi><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><munder><mo>âˆ‘</mo><mrow><mi>c</mi><mo>âˆˆ</mo><mi mathvariant=\"script\">C</mi></mrow></munder><munder><mo>âˆ‘</mo><mrow><mi>s</mi><mo>âˆˆ</mo><mi mathvariant=\"script\">S</mi></mrow></munder><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ¦</mo><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>c</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ§</mo><munder><mo>âˆ‘</mo><mrow><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">â€²</mo></msup><mo>âˆˆ</mo><mi mathvariant=\"script\">S</mi></mrow></munder><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ¦</mo><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">â€²</mo></msup><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>c</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ§</mo></mrow><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\mathscr{R}(g) = \\frac{ \\sum_{c \\in \\mathscr{C}} \\sum_{s \\in \\mathscr{S}} âŸ¦\\mathscr{C}(s|g)=câŸ§ \\sum_{s&#x27; \\in \\mathscr{S}} âŸ¦\\mathscr{C}(s&#x27;|g)=câŸ§ }{|\\mathscr{S}|}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.06259em;\">R</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.404972em;vertical-align:-0.936em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.468972em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.71708em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.1689em;\">C</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.19189em;\">S</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mopen\"><span class=\"mopen\">[</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mopen\">[</span></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\"><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mclose\">]</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6828285714285715em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">â€²</span></span></span></span></span></span></span></span></span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.19189em;\">S</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mopen\"><span class=\"mopen\">[</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mopen\">[</span></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">â€²</span></span></span></span></span></span></span></span></span><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\"><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mclose\">]</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>\n<p>Finally, we notice that the innermost sum is independent of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>,\nso we can factorize it:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"script\">R</mi><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><munder><mo>âˆ‘</mo><mrow><mi>c</mi><mo>âˆˆ</mo><mi mathvariant=\"script\">C</mi></mrow></munder><msup><mrow><mo fence=\"true\">(</mo><munder><mo>âˆ‘</mo><mrow><mi>s</mi><mo>âˆˆ</mo><mi mathvariant=\"script\">S</mi></mrow></munder><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ¦</mo><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>c</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">âŸ§</mo><mo fence=\"true\">)</mo></mrow><mn>2</mn></msup></mrow><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\mathscr{R}(g) = \\frac{ \\sum_{c \\in \\mathscr{C}} \\left(\\sum_{s \\in \\mathscr{S}} âŸ¦\\mathscr{C}(s|g)=câŸ§\\right)^2 }{|\\mathscr{S}|}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.06259em;\">R</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.730018em;vertical-align:-0.936em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.794018em;\"><span style=\"top:-2.368008em;\"><span class=\"pstrut\" style=\"height:3.054008em;\"></span><span class=\"mord\"><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-3.284008em;\"><span class=\"pstrut\" style=\"height:3.054008em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.7940180000000003em;\"><span class=\"pstrut\" style=\"height:3.054008em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.1689em;\">C</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size1\">(</span></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.19189em;\">S</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mopen\"><span class=\"mopen\">[</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mopen\">[</span></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\"><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:-0.17777777777777778em;\"></span><span class=\"mclose\">]</span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size1\">)</span></span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.054008em;\"><span style=\"top:-3.3029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>\n<p>That is much faster to compute:\nthere are only <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">C</mi><mi mathvariant=\"normal\">âˆ£</mi><mo>=</mo><msup><mn>3</mn><mn>5</mn></msup><mo>=</mo><mn>243</mn></mrow><annotation encoding=\"application/x-tex\">|\\mathscr{C}| = 3^5=243</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mord\">âˆ£</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">3</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">3</span></span></span></span> possible constraints,\nbut there are <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi><mo>=</mo><mn>3158</mn></mrow><annotation encoding=\"application/x-tex\">|\\mathscr{S}| = 3158</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\">âˆ£</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord\">8</span></span></span></span> word solutions.\nWhat used to take <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><msup><mi mathvariant=\"normal\">âˆ£</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">|\\mathscr{S}|^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\"><span class=\"mord\">âˆ£</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> operations\nnow takes <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi><mo>+</mo><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">C</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow><annotation encoding=\"application/x-tex\">|\\mathscr{S}| + |\\mathscr{C}|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\">âˆ£</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mord\">âˆ£</span></span></span></span>.\nThe computation that used to take hours in the previous article,\nnow takes a mere second:</p>\n<pre><span class=\"hljs-comment\"># Compute the average remaining solutions for each guess.</span>\n<span class=\"hljs-keyword\">function</span> average_remaining_solutions_after_guess(guess::<span class=\"hljs-built_in\">Vector</span>{<span class=\"hljs-built_in\">UInt8</span>}, solutions::<span class=\"hljs-built_in\">Vector</span>{<span class=\"hljs-built_in\">Vector</span>{<span class=\"hljs-built_in\">UInt8</span>}})::<span class=\"hljs-built_in\">Float64</span>\n  counts = zeros(<span class=\"hljs-built_in\">Int</span>, <span class=\"hljs-number\">243</span>)\n  <span class=\"hljs-keyword\">for</span> solution <span class=\"hljs-keyword\">in</span> solutions\n    <span class=\"hljs-meta\">@inbounds</span> counts[constraints(guess, solution) + <span class=\"hljs-number\">1</span>] += <span class=\"hljs-number\">1</span>\n  <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">return</span> sum(abs2, counts) / length(solutions)\n<span class=\"hljs-keyword\">end</span>\n</pre>\n<p>Hat tip to Douglas Bates from the Julia community\nfor <a href=\"https://discourse.julialang.org/t/rust-julia-comparison-post/75403/55\">figuring that out!</a></p>\n<p>From there, building an estimation of the number of remaining guesses <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>\nis smooth sailing. We can assume that we maintain\na constant ratio <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Ï</mi></mrow><annotation encoding=\"application/x-tex\">\\rho</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">Ï</span></span></span></span> of removed solutions after each guess.\nWe have <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow><annotation encoding=\"application/x-tex\">|\\mathscr{S}|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\">âˆ£</span></span></span></span> solutions currently, and at the end we have only 1.\nSo before the last guess, we had <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Ï</mi></mrow><annotation encoding=\"application/x-tex\">\\rho</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">Ï</span></span></span></span> solutions,\nand before the guess before that, we had <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>Ï</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\rho^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.008548em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Ï</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>â€¦\nAll the way back to now, where we have <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>Ï</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup><mo>=</mo><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow><annotation encoding=\"application/x-tex\">\\rho^{n-1} = |\\mathscr{S}|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.008548em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Ï</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">âˆ’</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\">âˆ£</span></span></span></span>.\nHence <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1</mn><mo>+</mo><mfrac><mrow><mi>log</mi><mo>â¡</mo><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow><mrow><mi>log</mi><mo>â¡</mo><mo stretchy=\"false\">(</mo><mi>Ï</mi><mo stretchy=\"false\">)</mo></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">n = 1 + \\frac{\\log|\\mathscr{S}|}{\\log(\\rho)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.53em;vertical-align:-0.52em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mop mtight\"><span class=\"mtight\">l</span><span class=\"mtight\">o</span><span class=\"mtight\" style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">Ï</span><span class=\"mclose mtight\">)</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mop mtight\"><span class=\"mtight\">l</span><span class=\"mtight\">o</span><span class=\"mtight\" style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace mtight\" style=\"margin-right:0.19516666666666668em;\"></span><span class=\"mord mtight\">âˆ£</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord mtight\">âˆ£</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.52em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>.</p>\n<pre><span class=\"hljs-comment\"># Including this guess, how many guesses remain until we win?</span>\n<span class=\"hljs-keyword\">function</span> estimate_guesses_remaining_statistically(guess::<span class=\"hljs-built_in\">Vector</span>{<span class=\"hljs-built_in\">UInt8</span>}, solutions::<span class=\"hljs-built_in\">Vector</span>{<span class=\"hljs-built_in\">Vector</span>{<span class=\"hljs-built_in\">UInt8</span>}})::<span class=\"hljs-built_in\">Float64</span>\n  avg_remaining = average_remaining_solutions_after_guess(guess, solutions)\n  nsols = length(solutions)\n  <span class=\"hljs-comment\"># Probability that the guess wins directly,</span>\n  <span class=\"hljs-comment\"># avoiding having to do another guess.</span>\n  prob_sol = <span class=\"hljs-keyword\">if</span> guess <span class=\"hljs-keyword\">in</span> solutions\n    <span class=\"hljs-number\">1</span> / nsols  <span class=\"hljs-comment\"># If this pick is a winner, there are no more guesses to make.</span>\n  <span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-number\">0</span>\n  <span class=\"hljs-keyword\">end</span>\n  expected_guesses = <span class=\"hljs-number\">1</span> + log(nsols) / log(nsols / avg_remaining)\n  <span class=\"hljs-keyword\">return</span> prob_sol * <span class=\"hljs-number\">1</span> + (<span class=\"hljs-number\">1</span>-prob_sol) * expected_guesses\n<span class=\"hljs-keyword\">end</span>\n</pre>\n<h3 id=\"Entropic\">Entropic <a href=\"#Entropic\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h3>\n<p>Of course, there are multiple ways to estimate the number of remaining guesses.\nInformation theory provides a framework for analysing\njust how much information we gain from the constraint that Wordle reveals.\nIn information theory, we deal with symbols\nand study the probability that they appear.</p>\n<p>In our case, we have one symbol for each constraint.\nThe probability that a constraint appears is\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>c</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi mathvariant=\"normal\">âˆ£</mi><mo stretchy=\"false\">{</mo><mi>s</mi><mi mathvariant=\"normal\">âˆ£</mi><mi>s</mi><mo>âˆˆ</mo><mi mathvariant=\"script\">S</mi><mo separator=\"true\">,</mo><mi mathvariant=\"script\">C</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mi mathvariant=\"normal\">âˆ£</mi><mi>g</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>c</mi><mo stretchy=\"false\">}</mo><mi mathvariant=\"normal\">âˆ£</mi></mrow><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">p(c) = \\frac{|\\{s|s \\in \\mathscr{S}, \\mathscr{C}(s|g)=c\\}|}{|\\mathscr{S}|}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.53em;vertical-align:-0.52em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">âˆ£</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord mtight\">âˆ£</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">âˆ£</span><span class=\"mopen mtight\">{</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mtight\">âˆ£</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.1689em;\">C</span></span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mtight\">âˆ£</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose mtight\">)</span><span class=\"mrel mtight\">=</span><span class=\"mord mathnormal mtight\">c</span><span class=\"mclose mtight\">}</span><span class=\"mord mtight\">âˆ£</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.52em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>.\nThe amount of information gained, in bits, by seeing a constraint\nis the entropy of Wordle:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"script\">H</mi><mo><mover><mo><mo>=</mo></mo><mtext>def</mtext></mover></mo><mo>âˆ’</mo><munder><mo>âˆ‘</mo><mrow><mi>c</mi><mo>âˆˆ</mo><mi mathvariant=\"script\">C</mi></mrow></munder><mi>p</mi><mo stretchy=\"false\">(</mo><mi>c</mi><mo stretchy=\"false\">)</mo><msub><mo><mi>log</mi><mo>â¡</mo></mo><mn>2</mn></msub><mi>p</mi><mo stretchy=\"false\">(</mo><mi>c</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathscr{H} \\stackrel{\\text{def}}{=} -\\sum_{c \\in \\mathscr{C}} p(c) \\log_2 p(c)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.152978em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.29694em;\">H</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mop op-limits\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.152978em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">=</span></span></span><span style=\"top:-3.5668699999999998em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">def</span></span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.38338em;vertical-align:-1.333375em;\"></span><span class=\"mord\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.050005em;\"><span style=\"top:-1.8439949999999998em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.1689em;\">C</span></span></span></span></span><span style=\"top:-3.0500049999999996em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.333375em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.20696799999999996em;\"><span style=\"top:-2.4558600000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.24414em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span></span></span></span></span>\n<p>At the end, once there are zero bits of information,\nwe know the solution for sure,\nbut we still have to submit it as a guess in order to win.\nBefore that, we were 2 guesses away from a win,\nand assuming we gain as many bits of information on each guess,\nwe had <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">H</mi></mrow><annotation encoding=\"application/x-tex\">\\mathscr{H}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.29694em;\">H</span></span></span></span></span> bits of information.\nBefore that, we were 3 guesses away from the end,\nand had <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi mathvariant=\"script\">H</mi></mrow><annotation encoding=\"application/x-tex\">2 \\mathscr{H}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.29694em;\">H</span></span></span></span></span> bits of information, and so forth.\nAt the start, the amount of information we had was\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">I</mi><mo><mover><mo><mo>=</mo></mo><mtext>def</mtext></mover></mo><msub><mo><mi>log</mi><mo>â¡</mo></mo><mn>2</mn></msub><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>Ã—</mo><mi mathvariant=\"script\">H</mi></mrow><annotation encoding=\"application/x-tex\">\\mathscr{I} \\stackrel{\\text{def}}{=} \\log_2|\\mathscr{S}| = (n-1) \\times \\mathscr{H}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.152978em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">I</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mop op-limits\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.152978em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">=</span></span></span><span style=\"top:-3.5668699999999998em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">def</span></span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.20696799999999996em;\"><span style=\"top:-2.4558600000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.24414em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\">âˆ£</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">Ã—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.29694em;\">H</span></span></span></span></span>.\nHence we obtain:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>n</mi><mo>=</mo><mfrac><mrow><mo>âˆ’</mo><msub><mo><mi>log</mi><mo>â¡</mo></mo><mn>2</mn></msub><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">S</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow><mrow><munder><mo>âˆ‘</mo><mrow><mi>c</mi><mo>âˆˆ</mo><mi mathvariant=\"script\">C</mi></mrow></munder><mi>p</mi><mo stretchy=\"false\">(</mo><mi>c</mi><mo stretchy=\"false\">)</mo><msub><mo><mi>log</mi><mo>â¡</mo></mo><mn>2</mn></msub><mi>p</mi><mo stretchy=\"false\">(</mo><mi>c</mi><mo stretchy=\"false\">)</mo></mrow></mfrac><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">n = \\frac{-\\log_2|\\mathscr{S}|}{\\sum_{c \\in \\mathscr{C}} p(c) \\log_2 p(c)} + 1\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.44008em;vertical-align:-1.01308em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">âˆ‘</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19028999999999985em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathscr mtight\" style=\"margin-right:0.1689em;\">C</span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32708000000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.20696799999999996em;\"><span style=\"top:-2.4558600000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.24414em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.20696799999999996em;\"><span style=\"top:-2.4558600000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.24414em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathscr\" style=\"margin-right:0.19189em;\">S</span></span><span class=\"mord\">âˆ£</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01308em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span></span>\n<p>This approach is <a href=\"https://www.youtube.com/watch?v=v68zYyaEmEA\">inspired by Grant Sanderson</a>,\nand has the redeeming quality of being efficient to compute\neven without casting mathematical spells on the formula:</p>\n<pre><span class=\"hljs-comment\"># Including this guess, how many guesses remain until we win?</span>\n<span class=\"hljs-keyword\">function</span> estimate_guesses_remaining_entropically(guess::<span class=\"hljs-built_in\">Vector</span>{<span class=\"hljs-built_in\">UInt8</span>}, solutions::<span class=\"hljs-built_in\">Vector</span>{<span class=\"hljs-built_in\">Vector</span>{<span class=\"hljs-built_in\">UInt8</span>}})::<span class=\"hljs-built_in\">Float64</span>\n  counts = zeros(<span class=\"hljs-built_in\">Int</span>, <span class=\"hljs-number\">243</span>)  <span class=\"hljs-comment\"># Number of times the constraint appears across solutions.</span>\n  <span class=\"hljs-keyword\">for</span> solution <span class=\"hljs-keyword\">in</span> solutions\n    <span class=\"hljs-meta\">@inbounds</span> counts[constraints(guess, solution) + <span class=\"hljs-number\">1</span>] += <span class=\"hljs-number\">1</span>\n  <span class=\"hljs-keyword\">end</span>\n  nsols = length(solutions)\n\n  entropy = <span class=\"hljs-number\">0.0</span>\n  <span class=\"hljs-keyword\">for</span> count <span class=\"hljs-keyword\">in</span> counts\n    <span class=\"hljs-keyword\">if</span> count == <span class=\"hljs-number\">0</span>\n      <span class=\"hljs-keyword\">continue</span>\n    <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-comment\"># Probability of a constraint appearing after we make this guess.</span>\n    prob = count / nsols\n    entropy -= prob * log2(prob)\n  <span class=\"hljs-keyword\">end</span>\n  expected_guesses = log2(nsols) / entropy + <span class=\"hljs-number\">1</span>\n\n  <span class=\"hljs-comment\"># Probability that the guess wins directly,</span>\n  <span class=\"hljs-comment\"># avoiding having to do another guess.</span>\n  prob_sol = <span class=\"hljs-keyword\">if</span> guess <span class=\"hljs-keyword\">in</span> solutions\n    <span class=\"hljs-number\">1</span> / nsols\n  <span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-number\">0</span>\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">return</span> prob_sol * <span class=\"hljs-number\">1</span> + (<span class=\"hljs-number\">1</span>-prob_sol) * expected_guesses\n<span class=\"hljs-keyword\">end</span>\n</pre>\n<p>Are those estimations good, though?</p>\n<h2 id=\"Weighing_the_souls_of_our_formulae\">Weighing the souls of our formulae <a href=\"#Weighing_the_souls_of_our_formulae\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h2>\n<p>Estimators always offer a tradeoff.\nWhat matters at the end is not how good it is on its own,\nbut how well it melds within the overall struture.</p>\n<h3 id=\"Heuristic\">Heuristic <a href=\"#Heuristic\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h3>\n<p>The first thought you might have on how to use the estimator,\nis to pick its best suggested guess at each step of the game.\nHere is what we would get:</p>\n<table>\n  <tr><th> Estimator </th><th> Expected number of guesses to win </th></tr>\n  <tr><td> Statistical </td><td> 3.6450 </td></tr>\n  <tr><td> Entropic </td><td> 3.5687 </td></tr>\n</table>\n<p>That is better than the <a href=\"https://www.nytimes.com/2023/03/08/crosswords/refreshing-gameplay.html\">human average of about 4</a>!</p>\n<p>It also seems to prefer entropic calculations.\nThat could be due to chance, however.</p>\n<p>(By the way, beware of comparing any of the figures I give to other articles.\nBot performances depend on the word lists,\nwhich the <em>New York Times</em> has changed multiple times,\nmaking the game slightly harder.\nMeanwhile, human statistics often have selection bias,\nconsidering that people that fail to solve in 6 guesses\ncannot give the true number of guesses they would require,\non top of the obvious bias that people only publish good results.)</p>\n<h3 id=\"Accuracy\">Accuracy <a href=\"#Accuracy\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h3>\n<p>Heuristics give a good-enough strategy.\nWe want to go further than â€œgood enoughâ€ though.\nWe target optimal play.</p>\n<p>With that in mind, the true intent of the estimator\nis to predict the performance of perfect play.\nLetâ€™s compare the estimation to\n<a href=\"https://sonorouschocolate.com/notes/index.php/The_best_strategies_for_Wordle,_part_3_(July_2023)\">the true optimal figure</a>.</p>\n<table>\n  <tr><th> Estimator </th><th> Mean squared error </th></tr>\n  <tr><td> Statistical </td><td> 0.9932 </td></tr>\n  <tr><td> Entropic </td><td> 0.1044 </td></tr>\n</table>\n<p>The entropic estimation wins again; that said, surprisingly,\nif we restrict the analysis to the best 100 guesses,\nwhich are most likely to be useful,\nwe get a reversed picture, which may matter later:</p>\n<table>\n  <tr><th> Estimator </th><th> Mean squared error </th></tr>\n  <tr><td> Statistical </td><td> 0.0266 </td></tr>\n  <tr><td> Entropic </td><td> 0.2533 </td></tr>\n</table>\n<h3 id=\"Convergence\">Convergence <a href=\"#Convergence\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h3>\n<p>Hereâ€™s a sneak peek at how each estimator fares\nwithin a self-optimizing algorithm.</p>\n<p>That algorithm iterates until it finds the optimal choices\nthroughout the whole game, for all possible solutions.\nWhat we plot is the optimizerâ€™s best-known playing strategy.\nIt is conservative, not an estimation:\nit starts out on iteration zero (not depicted) at 3158 guesses\n(brute-forcing through all possible words).\nWhenever it has yet to explore a guess, it assumes brute-force,\nthus offering an upper bound on the optimal strategy\nwhich eventually converges to it.</p>\n<p>We want that algorithm to converge to the optimal strategy fast,\nand the number of iterations is a good proxy\nfor how long it takes to achieve a certain level.</p>\n<p><img src=\"../assets/perfect-play-with-generic-methods/estimator.svg\" alt=\"Graph of the upper bound on average number of guesses per game, as a function of the number of iterations\" /></p>\n<p>The statistical estimator starts out with an advantage,\nlikely because it is more accurate for better guesses.\nBut that makes it overconfident on its accuracy;\nmeanwhile the entropic estimatorâ€™s evaluated uncertainty\nencourages it to search through a wider array of options,\nand it eventually overtakes the statistical one permanently,\nfinding the optimal strategy first.</p>\n<h2 id=\"Coincidental_circumstances\">Coincidental circumstances <a href=\"#Coincidental_circumstances\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h2>\n<p>Was it obvious from the get-go that the entropic estimator would end up on top?\nIt feels to me like there is a bit of luck involved:</p>\n<ul>\n<li>Its formula gives way to a fast algorithm without mathematical tour-de-force;</li>\n<li>Its higher accuracy overall ends up being beneficial,\ndespite being less accurate on the guesses that matter,\nlikely because it predicts pairwise rankings better;</li>\n<li>By sheer luck, on the current wordlist, its top guess is the optimal guess.</li>\n</ul>\n<p>In the next article, letâ€™s dig further into the weeds\nof building a fully game-agnostic self-optimizing algorithm\nthat finds the best strategy fast,\nusing the entropic estimator as a foundation.</p>\n<script type=\"application/ld+json\">\n{ \"@context\": \"http://schema.org\",\n  \"@type\": \"BlogPosting\",\n  \"datePublished\": \"2024-02-17T10:24:32Z\",\n  \"keywords\": \"ml, julia, optimization\" }\n</script>\n",
      },
      {
        "id":  "https://espadrine.github.io/blog/posts/chinchilla-s-death.html",
        "url": "https://espadrine.github.io/blog/posts/chinchilla-s-death.html",
        "title": "Chinchillaâ€™s Death",
        "tags": "gpu ml",
        "date_published": "2023-07-23T17:35:02Z"
        "content_html": "<h1 id=\"Chinchilla_s_Death\">Chinchillaâ€™s Death <a href=\"#Chinchilla_s_Death\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h1>\n<blockquote>\n<p>â€œWith more careful calculations, one can win; with less, one cannotâ€\nâ€” Sun Tzu, <em>The Art of War</em>.</p>\n</blockquote>\n<p>Making extrapolations is crucial to avoid wasting our computing power on slow\nconvergence. After all, if you had to walk to the Everest,\nyou wouldnâ€™t eyeball it: you would use a GPS.</p>\n<p>Sometimes you have to look away from the GPS and onto the road, though.\nSometimes things donâ€™t extrapolate through simple formulae.\nIt was true for XIXth-century physicists with the <a href=\"https://en.wikipedia.org/wiki/Ultraviolet_catastrophe\">ultraviolet catastrophe</a>;\nit is true for LLMs too.\nWhat we estimate to be true near the center can deviate widely in the far landsâ€¦</p>\n<p><img src=\"https://i.imgur.com/Mf85NuW.png\" alt=\"Image of Minecraft far lands: a terrain that suddenly becomes distorted and overlaps itself cliffly\" /></p>\n<h2 id=\"What_s_this_Chinchilla_thing_anyway_\">Whatâ€™s this Chinchilla thing anyway? <a href=\"#What_s_this_Chinchilla_thing_anyway_\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h2>\n<p>Smaller models have fewer multiplications.\nThus they run faster. Thus they train faster.\nHowever, the theory goes, they eventually reach the limit of their capacity for\nknowledge, and their learning slows, while that of a larger model,\nwith a larger capacity, will overtake them and reach better performance\npast a given amount of training time.</p>\n<p>While estimating how to get the best bang for the buck during training,\nboth <a href=\"https://arxiv.org/abs/2001.08361\">OpenAI</a> and <a href=\"https://arxiv.org/abs/2203.15556\">DeepMind</a> attempted to draw the Pareto\nfrontier. They donâ€™t state explicitly that they use that theory to draw it;\nthe closest quote that hints at this hidden assumption is from OpenAI:</p>\n<blockquote>\n<p>We expect that larger models should always perform better than smaller models.\n[â€¦]\nA model with fixed size will be capacity-limited.</p>\n</blockquote>\n<p>This presumption is the bedrock of how they compute the Pareto frontier.\nIn the Chinchilla work, figure 2 shows the training loss of a large number of\ntraining runs for models with varying size.\nAt a first glance, those curves follow the theory:\nthe smaller models initially have a lower loss (good),\nbut eventually it slows down,\nand gets overtaken by the curve from a larger model (bad).</p>\n<p><img src=\"../assets/chinchilla-s-death/chinchilla.png\" alt=\"Chinchilla graph comparing the loss curves for many different model sizes\" /></p>\n<p>In that chart, they drew grey dots every time they pinpointed the smaller model\nstarting to lose out to a larger model.\nThe grey line, the Pareto frontier, is how they computed their scaling laws.</p>\n<p>The problem with this assumption is that\nwe have no idea what would happen if we let the smaller model train for longer,\nsince they stopped its training as soon as it was overtaken.</p>\n<p>Enter the LLaMA paper.</p>\n<h2 id=\"Can_Chinchillas_picture_a_Llama_s_sights_\">Can Chinchillas picture a Llamaâ€™s sights? <a href=\"#Can_Chinchillas_picture_a_Llama_s_sights_\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h2>\n<p>Earlier this year, Meta trained four models with varying sizes.\nUnlike other works, they trained each of them for a very large amount of time;\neven the smaller ones.</p>\n<p>They published the training run curves:</p>\n<p><img src=\"../assets/chinchilla-s-death/llama1-training.png\" alt=\"Training loss curves for the four LLaMA model sizes\" /></p>\n<ol>\n<li>Each curve first plummets in a <strong>power law</strong>,</li>\n<li>and then seemingly enters a <strong>nearly-linear</strong> decrease in loss\n(corresponding to a fairly constant rate of knowledge acquisition).</li>\n<li>At the very tip of the curve, they all break this line by <strong>flattening</strong>\nslightly.</li>\n</ol>\n<p>Right off the bat, I want to tackle a subtle misconception that people can have\nrelated to the end-of-curve flattening.\nThey are all trained with gradient descent using a variable learning rate\n(which is, roughly,\na hyperparameter for how much to go in the direction of the gradient).\nTo get a good training, they had to constantly decrease the learning rate,\nso that it can detect ever-subtler patterns in the source material.\nThe formula they use for that decrease is the most widely used:\nthe cosine schedule.</p>\n<p><img src=\"../assets/chinchilla-s-death/warmup_cosine_schedule.png\" alt=\"Learning rate as a function of training steps under a cosine schedule with\nwarmup: it first increases linearly, then slopes down with increasing speed,\nbefore reaching an inflection point halfway and slowing down ever slower. Image from Huggingface documentation\" /></p>\n<p>As you can see from the graph, towards the end of the training run,\nthe cosine schedule stops decreasing the learning rate at the speed which\nyielded such a good, near-linear training loss curve.\nThe slowdown in learning is an artefact of that.\nThe model does not necessarily cease to have\nthe capacity to learn at the same near-linear rate!\nIn fact, if we had more text to give it,\nwe would have stretched the cosine schedule,\nso its learning rate would have continued to go down at the same rate.</p>\n<p>The modelâ€™s fitness landscape does not depend on the amount of data\nwe can feed its training; so the change in learning rate decrease\nis not well-justified.</p>\n<p>That is not the main point of this article, though.</p>\n<p>The training loss curve can be misleading in another way.\nSure, they are all trained on the same data;\nbut they donâ€™t go through that data at the same speed.\nWhat we want to know is <strong>not</strong> how sample-efficient the model is\n(on this front, the larger model clearly learns more from what it saw).\nLetâ€™s picture instead a race:\nall those models start at the same time,\nand we want to know which one crosses the finish line first.\nIn other words, when throwing a fixed amount of compute at the training,\nwho learns the most in that time?</p>\n<p>Thankfully, we can combine the loss curves with another piece of data that Meta\nprovided: the amount of time that each model took to train.</p>\n<table>\n <tr><th>   Model   </th><th> GPU-hours </th><th> Tokens/second </th>\n <tr><td> LLaMA1-7B  </td><td>   82432  </td><td>    3384.3    </td>\n <tr><td> LLaMA1-13B </td><td>  135168  </td><td>    2063.9    </td>\n <tr><td> LLaMA1-33B </td><td>  530432  </td><td>     730.5    </td>\n <tr><td> LLaMA1-65B </td><td> 1022362  </td><td>     379.0    </td>\n</table>\n<p><img src=\"../assets/chinchilla-s-death/llama1-training-speed.svg\" alt=\"LLaMA 1 training loss vs GPU-hours spent\" /></p>\n<p><a href=\"https://github.com/espadrine/espadrine.github.com/blob/master/blog/assets/chinchilla-s-death/llama-data.py\"><em>(Code for generating the graph here.)</em></a></p>\n<p>Letâ€™s first mention that the whole Chinchilla graph that we saw,\ncovers only a small sliver on the left of this graph.\nIn that sliver, we see the same behaviour that Chinchilla documents.\nLook at the 7B, for instance (which in the Chinchilla graph would actually be\namong the top two curves in terms of size):\nit initially drops its loss much faster than the bigger models, then slows down,\nand the 13B model overtakes it and reaches 1.9 first.</p>\n<p>But then, comes a far-lands, unexpected twist: the 7B enters a near-linear\nregime, with a steep downward trend, and seems on its way to maybe overpass the\n13B again? It is hard to tell on that graph what would happen if the 7B was\ntrained for longer.</p>\n<p>However, the same behaviour seemed to be true between the 13B and the 33B,\nwhere the initial Chinchilla slowdown also gives way to a near-linear regime,\nat which point the 13B goes down fast! It is only surpassed by the 33B unfairly,\nby granting the latter more than double the compute time.</p>\n<p>And the same slowdown-then-speedup occurs between the 33B and the 65B,\nto such an extent that the 33B never actually gets overtaken by the 65B.\nWhat the graph shows breaks OpenAIâ€™s and Chinchillaâ€™s assumption:\n<strong>the bigger model hasnâ€™t won</strong> (yet).\nThe slowdown they detected is not actually caused by reaching some capacity limit!</p>\n<p>Still, that 7B line is a bit unsatisfactory.\nIf only Meta had trained it for longerâ€¦</p>\n<p>Suspense over: they did! They released LLaMA 2 this week!</p>\n<h2 id=\"Time_to_confirm_our_suspicions\">Time to confirm our suspicions <a href=\"#Time_to_confirm_our_suspicions\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h2>\n<p><img src=\"../assets/chinchilla-s-death/llama2-training.png\" alt=\"Training loss curves for the four LLaMA 2 model sizes\" /></p>\n<p>We also, again, got the training times:</p>\n<table>\n <tr><th>   Model   </th><th> GPU-hours </th><th> Tokens/second </th>\n <tr><td> LLaMA2-7B  </td><td>  184320  </td><td>    3031.9    </td>\n <tr><td> LLaMA2-13B </td><td>  368640  </td><td>    1515.9    </td>\n <tr><td> LLaMA2-34B </td><td> 1038336  </td><td>     533.7    </td>\n <tr><td> LLaMA2-70B </td><td> 1720320  </td><td>     322.1    </td>\n</table>\n<p><img src=\"../assets/chinchilla-s-death/llama2-training-speed.svg\" alt=\"LLaMA 2 training loss vs GPU-hours spent\" /></p>\n<p>Immediately, at a glance, we notice that the training curves donâ€™t match those\nof LLaMA 1, even when the models are identical.\nAs it turns out, LLaMA 2 was trained on double the context size,\nand a longer cosine schedule, which unfortunately\nhas negatively impacted all model sizes.\nHowever, smaller models have been impacted worse than larger ones.\nAs a result, the 34B model, which in LLaMA 1 remained always better than the 65B\nmodel at any training time spent, now dips slightly above the 70B model,\nbefore overtaking it:</p>\n<p><img src=\"../assets/chinchilla-s-death/llama-training-speed-comparison.webp\" alt=\"LLaMA 1 vs 2 training loss vs GPU-hours spent\" /></p>\n<p>More importantly, comparing the training speeds strongly confirms our suspicions\nfrom LLaMA 1:</p>\n<ol>\n<li>First, they are faster than bigger models,</li>\n<li>Then, they slow down, and are overtaken by larger models (as per\nChinchilla),</li>\n<li>BUT THEN, they enter the near-linear regime, in which smaller models have a\nsteeper descent into superior knowledge, and they overtake larger models\nyet again!</li>\n</ol>\n<p>A fascinating consequence ties into making the right choices\nwhen starting a training run:\ncontrary to popular belief, <strong>larger models yield worse results</strong>.\nIf you had to pick a parameter size and dataset, you might be better off opting\nfor a 7B model and training for 7 epochs on trillions of tokens.</p>\n<p>Look at the near-linear regime of the 7B model, and extrapolate its line to when\nthe 70B model stopped:\nhad the 70B computation been spent on the 7B instead,\nit would potentially have reached a lower perplexity!</p>\n<p>Another thing we notice from LLaMA 2 is that the learning slowdown at the end of\nthe LLaMA 1 curves was indeed an artefact of the cosine schedule.\nThat slowdown is completely absent from the LLaMA 2 training run at the\ncorresponding mark of 1 trillion tokens read.</p>\n<p>In fact, maybe the reason that, at that same mark, the LLaMA 2 7B model has a\nworse quality than the LLaMA 1 7B model had,\nmay be because <em>its cosine schedule is stretched</em>!</p>\n<p>Letâ€™s go back to the Chinchilla paper to argue that point.\nIn appendix A, figure A1, they show an ablation study for various cosine\nschedule parameters (phrased another way:\nvarious ways to stretch the learning rate curve).</p>\n<p><img src=\"../assets/chinchilla-s-death/chinchilla-cosine-ablation-study.png\" alt=\"Chinchilla cosine schedule ablation study\" /></p>\n<p>They make the point that the lowest loss is achieved when the curve is not\nstretched. That is supported by the graphs, but we notice something off.\nAfter reading 6 million tokens, the training loss at the top is below 2.8;\nmeanwhile, at the same mark, the training loss of the bottom model is above.\nYet the only difference between the models is the cosine schedule!\nBecause the bottom model was slated to go through more training data,\nthe â€œunstretchedâ€ cosine schedule was computed for a bigger number of steps,\nwhich effectively stretches it.\nIf the learning rate had instead followed\nthe schedule assigned to fewer training steps,\nit would have had a better loss for the same amount of training time.</p>\n<p>More broadly, that raises a question that I leave open:\nif the cosine schedule is not optimal,\nhow should the shape of its tail be instead?</p>\n<script type=\"application/ld+json\">\n{ \"@context\": \"http://schema.org\",\n  \"@type\": \"BlogPosting\",\n  \"datePublished\": \"2023-07-23T17:35:02Z\",\n  \"keywords\": \"gpu, ml\" }\n</script>\n",
      },
      {
        "id":  "https://espadrine.github.io/blog/posts/recomputing-gpu-performance.html",
        "url": "https://espadrine.github.io/blog/posts/recomputing-gpu-performance.html",
        "title": "Recomputing ML GPU performance: AMD vs. NVIDIA",
        "tags": "gpu ml",
        "date_published": "2023-06-18T21:40:09Z"
        "content_html": "<h1 id=\"Recomputing_ML_GPU_performance_AMD_vs_NVIDIA\">Recomputing ML GPU performance: AMD vs. NVIDIA <a href=\"#Recomputing_ML_GPU_performance_AMD_vs_NVIDIA\" class=\"autolink-clicker\" aria-hidden=\"true\">Â§</a></h1>\n<p>I am pretty impressed seeing <a href=\"https://twitter.com/LisaSu/status/1669848494637735936\">Lisa Su</a> doing her best to steer the AMD ship towards\nbetter AI support in GPUs, with the <a href=\"https://huggingface.co/blog/huggingface-and-amd\">Huggingface partnership</a> and by convincing\nGeorge Hotz to submit more bug reports.</p>\n<p>(For context, <a href=\"https://geohot.github.io//blog/jekyll/update/2023/05/24/the-tiny-corp-raised-5M.html\">Hotz raised $5M</a> to improve RX 7900 XTX support and sell a $15K\nprebuilt consumer computer that runs 65B-parameter LLMs. A plethora of driver\ncrashes later, he almost <a href=\"https://github.com/RadeonOpenCompute/ROCm/issues/2198#issuecomment-1574383483\">gave up on AMD</a>.)</p>\n<p>Thereâ€™s quite a few issues to overcome, though.\nWhile that GPU is great\n(<a href=\"https://www.tomshardware.com/news/stable-diffusion-gpu-benchmarks\">Stable Diffusion iteration speed per GPU cost</a> is top-tier),\na cursory study would be flawed:\npublic GPU benchmarks like TechPowerUp, TomsHardware, etc. give:</p>\n<ul>\n<li><strong>RX 7900 XTX:</strong> <a href=\"https://www.techpowerup.com/gpu-specs/geforce-rtx-4090.c3889\">123 TFLOPS</a></li>\n<li><strong>RTX 4090:</strong> <a href=\"https://www.tomshardware.com/reviews/amd-radeon-rx-7900-xtx-and-xt-review-shooting-for-the-top\">82.58 TFLOPS</a></li>\n</ul>\n<p>Where do the figures come from?</p>\n<p>While there is no official breakdown,\nonly <a href=\"https://www.amd.com/en/products/graphics/amd-radeon-rx-7900xtx\">official figures</a>, people widely compute it this way:</p>\n<ul>\n<li>For <strong>NVIDIA</strong>:\n<a href=\"https://www.nvidia.com/en-us/geforce/graphics-cards/compare/#sectionenhanced_copy_54756033603dff4c2_db18_46bd_9cc1_e7ad0debbbd0\">Boost Clock (THz) Ã— CUDA Cores Ã— 2</a>\n(since the FMA instruction does two floating-point operations\n(a multiplication and an addition) in 1 CUDA core cycle).</li>\n<li>For <strong>AMD</strong> on RDNA3:\n<a href=\"https://www.amd.com/en/products/graphics/amd-radeon-rx-7900xtx\">Boost Frequency (THz) Ã— Stream processors Ã— 2 (dual issue) Ã— 4 (dot product)</a>,\nas <a href=\"https://www.amd.com/system/files/TechDocs/rdna3-shader-instruction-set-architecture-feb-2023_0.pdf\">RDNA3 has <code>V_DUAL_DOT2ACC_F32_F16</code></a>,\nwhich does two dot products (aÃ—b+cÃ—d+e, 4 operations),\nin 1 processor cycle.</li>\n</ul>\n<table>\n  <tr><th> Name </th><th> Price </th><th> Processors </th><th> Frequency </th><th> TFLOPS (FP16) </th><th> Perf/â‚¬ </th>\n  <tr><td> <a href=\"https://www.amd.com/en/products/graphics/amd-radeon-rx-7900xtx\">RX 7900 XTX</a> </td>\n      <td> â‚¬1110 </td><td>  6144 </td><td>  2.5 GHz </td><td> 122.88 </td><td> .1107 </td>\n  <tr><td> <a href=\"https://www.amd.com/en/products/graphics/amd-radeon-rx-7900xt\">RX 7900 XT</a> </td>\n      <td>  â‚¬942 </td><td>  5376 </td><td>  2.4 GHz </td><td> 103.22 </td><td> .1096 </td>\n  <tr><td> <a href=\"https://www.nvidia.com/en-us/geforce/graphics-cards/compare/#sectionenhanced_copy_54756033603dff4c2_db18_46bd_9cc1_e7ad0debbbd0\">RTX 4090</a> </td>\n      <td> â‚¬1770 </td><td> 16384 </td><td> 2.52 GHz </td><td>  82.58 </td><td> .0467 </td>\n  <tr><td> <a href=\"https://www.nvidia.com/en-us/geforce/graphics-cards/compare/#sectionenhanced_copy_44862952d932bba4_58ad_4ca4_a3d3_84a2295d2b85\">RTX 3060</a> </td>\n      <td>  â‚¬314 </td><td>  3584 </td><td> 1.78 GHz </td><td>  12.76 </td><td> .0405 </td>\n  <tr><td> <a href=\"https://www.nvidia.com/en-us/geforce/graphics-cards/compare/#sectionenhanced_copy_44862952d932bba4_58ad_4ca4_a3d3_84a2295d2b85\">RTX 3080</a> </td>\n      <td>  â‚¬905 </td><td>  8704 </td><td> 1.71 GHz </td><td>  29.76 </td><td> .0329 </td>\n  <tr><td> <a href=\"https://www.nvidia.com/en-us/geforce/graphics-cards/compare/#sectionenhanced_copy_44862952d932bba4_58ad_4ca4_a3d3_84a2295d2b85\">RTX 3090</a> </td>\n      <td> â‚¬1500 </td><td> 10496 </td><td> 1.70 GHz </td><td>  35.68 </td><td> .0238 </td>\n</table>\n<p>That is an unjust comparison, though, because AMDâ€™s instruction is more niche\nthan FMA (hitting this performance sweet spot is thus uncommon),\nand because both of those GPUs have other tricks up their sleeves,\nyielding superior FLOPS.</p>\n<p>The <a href=\"https://timdettmers.com/2023/01/30/which-gpu-for-deep-learning/#Will_AMD_GPUs_ROCm_ever_catch_up_with_NVIDIA_GPUs_CUDA\">big one</a> on NVIDIA are <a href=\"https://www.nvidia.com/en-us/data-center/tensor-cores/\">Tensor cores</a>.\nWith them, you can run an instruction that does\n<a href=\"https://www.nvidia.com/content/PDF/nvidia-ampere-ga-102-gpu-architecture-whitepaper-v2.pdf\">a 4Ã—4 to 4Ã—8 matrix multiplication (page 25)</a>\nin 1 cycle within a single Tensor Core (32 CUDA cores).</p>\n<p>2Ã—4^2Ã—8 (matmul ops) Ã· 1 (cycles) = 256 ops/TC/cycle.</p>\n<p>(There is <a href=\"https://developer.nvidia.com/blog/nvidia-ampere-architecture-in-depth/\">some variation between NVIDIA GPUs</a>\non which matrix sizes are supported and on how many cycles the instruction takes,\nand NVIDIA keeps major aspects of their instruction set secret,\nbut on recent 30- and 40-series, this 256 number seems fairly constant.)</p>\n<p><img src=\"https://www.nvidia.com/content/dam/en-zz/Solutions/gtcs22/tensor-cores/hopper-tensor-core-ampere-2c50-t.jpg\" alt=\"Official image showing the matrix size for third-generation tensor cores with V100 FP32\" /></p>\n<p>That actually puts the RTX 4090 at\n256 Ã— 512 (Tensor Cores) Ã— 2.52 (GHz)\nÃ· 1K (GHz per teracycle/s) = <a href=\"https://en.wikipedia.org/wiki/GeForce_40_series#Desktop\">330 TFLOPS in FP16</a>â€¦\nMuch higher than the 123 TFLOPS that impressed Hotz on the RX 7900 XTX!</p>\n<p>But AMD now has the same trick.\nIn <a href=\"https://www.amd.com/system/files/TechDocs/rdna3-shader-instruction-set-architecture-feb-2023_0.pdf\">RDNA3</a>, with <a href=\"https://gpuopen.com/learn/wmma_on_rdna3/\">WMMA</a>, the RX 7900 XTX has an instruction,\n<a href=\"https://www.amd.com/system/files/TechDocs/rdna3-shader-instruction-set-architecture-feb-2023_0.pdf\"><code>V_WMMA_F16_16X16X16_F16</code></a>\nthat do two 16Ã—16 matrix multiplications in <a href=\"https://github.com/RadeonOpenCompute/amd_matrix_instruction_calculator/blob/339d784e56e55752495192b0781ea162fc32e323/matrix_calculator.py#LL1139C26-L1139C26\">32 cycles</a>,\nin a single Compute Unit (two sets of 32 threads).</p>\n<p>2Ã—16^3 (matmul ops) Ã— 2 Ã· 32 (cycles) = 512 ops/CU/cycle.</p>\n<p>This uses the same underlying silicon circuits as <code>V_DUAL_DOT2ACC_F32_F16</code>:\nthe architecture lays out the matrices in Vector General-Purpose Registers.\nEach cell of the output matrix is computed by multiplying\none row from input matrix A with one column from input matrix B,\ntwo input cells at a time\n(two adjacent input A row cells packed inside the same VGPR,\nand two adjacent input B column cells packed together inside another VGPR),\nso they can be used by the packed dot product single-cycle instruction.\nWithin that same instruction, encoded in VOPQ\n(a SIMD-like system to execute one operation\non an even register while it executes on an odd one at the same time),\nan adjacent output cell also multiplies through its first two input cells\nat the same time using dual issue.</p>\n<p>The input row has size 16, so those two output cells are completed in 8 cycles.\nEach two adjacent output cells in their diagonal\nare computed with 16 parallel threads (on separate stream processors)\nwithin the same 8 cycles.\nWe have done two diagonals (32 output cells); there are 14 diagonals left.\nInside that Compute Unit, we still have 16 stream processors that we can use;\nthey can handle two more output diagonals within the same 8 cycles.</p>\n<p>Once our first four diagonals are computed,\nwe sequentially compute the next 4 diagonals in the next 8 cycles.\nSo forth for the next 4, and the last 4 after that.\nIn total, we have computed the matrix multiplication\nin 32 cycles, which checks out.</p>\n<p>Why canâ€™t we do the matrix multiplication in 16 cycles\nby using all 64 threads inside of the Compute Unit?\n<a href=\"https://www.amd.com/system/files/TechDocs/rdna3-shader-instruction-set-architecture-feb-2023_0.pdf\">Section 7.6 of the instruction set manual</a> indicates:</p>\n<blockquote>\n<p>[Dual issue] is legal only for wave32.</p>\n</blockquote>\n<p>WMMA supports both wave32 and wave64, but it sounds like dual issue is\ndeactivated in wave64, and thus it would still take 32 cycles,\nmaking it an ill-documentedly unfavorable proposition, I believe.</p>\n<p>All in all, using <a href=\"https://gpuopen.com/learn/wmma_on_rdna3/\">WMMA</a>, the RX 7900 XTX can crank through\n512 Ã— <a href=\"https://www.amd.com/en/products/graphics/amd-radeon-rx-7900xtx\">96 (Compute Units) Ã— 2.5 (GHz)</a>\nÃ· 1K (GHz per teracycle/s) = <a href=\"https://en.wikipedia.org/wiki/RDNA_3#Desktop\">123 TFLOPS in FP16</a>â€¦</p>\n<p>That ends up being less than half the performance of the RTX 4090.\nThe superior number of operations per Compute Unit is offset by the\ncrushingly lower number of cores.\nPerhaps the AMD strategy is to have the better circuit ready\nbefore migrating to the TSMC N5 (â€œ5 nmâ€) process at a less affordable price.</p>\n<p>In practice, the lower performance is less of an issue for AI training,\nbecause they are famously limited in the amount of parallelization opportunities\n(even the best training runs typically incur only 50% GPU use at a given time).\nThe VRAM bandwidth then matters a lot for large models,\nand the <a href=\"https://www.amd.com/en/products/graphics/amd-radeon-rx-7900xtx\">RX 7900 XTX</a>, despite using GDDR6 instead of GDDR6X,\nhas a higher bandwidth than the RTX 3090, thanks to its faster memory clock.\nStill, it also is lower than the RTX 4090 on that front\n(but at a lower price point).</p>\n<table>\n  <tr><th> Name </th><th> Price </th><th> TFLOPS (FP16) </th><th> Memory bandwidth (GB/s)</th><th> RAM (GB) </th><th> TFLOPS/â‚¬ </th><th> Value (TFLOPSÂ·GBÂ·MB/s/â‚¬Â³) </th>\n  <tr><td> <a href=\"https://www.nvidia.com/en-us/geforce/graphics-cards/compare/#sectionenhanced_copy_54756033603dff4c2_db18_46bd_9cc1_e7ad0debbbd0\">RTX 4090</a> </td>\n      <td> â‚¬1770 </td><td> 330 </td><td> 1008 </td><td> 24 </td><td> .186 </td><td> 1.4 </td>\n  <tr><td> <a href=\"https://www.nvidia.com/en-us/geforce/graphics-cards/compare/#sectionenhanced_copy_44862952d932bba4_58ad_4ca4_a3d3_84a2295d2b85\">RTX 3060</a> </td>\n      <td>  â‚¬314 </td><td> 51 </td><td> 360 </td><td> 12 </td><td> .162 </td><td> 7.1 </td>\n  <tr><td> <a href=\"https://www.nvidia.com/en-us/geforce/graphics-cards/compare/#sectionenhanced_copy_44862952d932bba4_58ad_4ca4_a3d3_84a2295d2b85\">RTX 3080</a> </td>\n      <td>  â‚¬905 </td><td> 119 </td><td> 760 </td><td> 10 </td><td> .131 </td><td> 1.2 </td>\n  <tr><td> <a href=\"https://www.amd.com/en/products/graphics/amd-radeon-rx-7900xtx\">RX 7900 XTX</a> </td>\n      <td> â‚¬1110 </td><td> 123 </td><td> 960 </td><td> 24 </td><td> .111 </td><td> 2.1 </td>\n  <tr><td> <a href=\"https://www.amd.com/en/products/graphics/amd-radeon-rx-7900xt\">RX 7900 XT</a> </td>\n      <td>  â‚¬942 </td><td> 103 </td><td> 800 </td><td> 20 </td><td> .109 </td><td> 2.0 </td>\n  <tr><td> <a href=\"https://www.nvidia.com/en-us/geforce/graphics-cards/compare/#sectionenhanced_copy_44862952d932bba4_58ad_4ca4_a3d3_84a2295d2b85\">RTX 3090</a> </td>\n      <td> â‚¬1500 </td><td> 143 </td><td> 936 </td><td> 24 </td><td> .095 </td><td> 1.0 </td>\n</table>\n<p><em>(The value unit was edited per <a href=\"https://www.reddit.com/r/espadrine/comments/156bbmj/comment/kcozddn/\">Scheurneusâ€™ suggestion</a>.)</em></p>\n<p>Thus the RX 7900 XTX is not technically the best TFLOPS per price,\nas was presumed in Hotzâ€™s <a href=\"https://geohot.github.io//blog/jekyll/update/2023/05/24/the-tiny-corp-raised-5M.html\">raise announcement</a>.\nBut that metric is not crucial for the purpose of making LLM machines,\nand purely looking at hardware, that GPU is a fine choice for that,\nin part because it has a fairer RAM per dollar offer,\nso that it can hold a large model without needing pricier GPUS,\nyet likely reaching reasonable inference speeds.</p>\n<p>The other thorns on the side of AMD in AI, though, rear their ugly heads:</p>\n<ul>\n<li><a href=\"https://chipsandcheese.com/2023/01/07/microbenchmarking-amds-rdna-3-graphics-architecture/\">The compilers donâ€™t produce great instructions</a>;</li>\n<li>The drivers crash frequently: ML workloads feel experimental;</li>\n<li>Software adoption is getting there,\nbut kernels are less optimized within frameworks,\nin particular because of the fracture between ROCm and CUDA.\nWhen you are a developer and you need to write code twice,\none version wonâ€™t be as good, and it is the one with less adoption;</li>\n<li>StackOverflow mindshare is lesser. Debugging problems is thus harder,\nas fewer people have encountered them.</li>\n</ul>\n<p>(I will note, however, that the wealth of information provided by AMD\noutshines that from NVIDIA tremendously,\neven though they could better vulgarize those subtleties and\nexplain how to perform specific workloads like BERT training,\ninto which NVIDIA puts welcome care.\nJust contrast <a href=\"https://docs.nvidia.com/deeplearning/performance/dl-performance-matrix-multiplication/index.html\">NVIDIAâ€™s matmul page</a> to <a href=\"https://gpuopen.com/learn/wmma_on_rdna3/\">AMDâ€™s</a>.\n<a href=\"https://rocm.docs.amd.com/en/latest/release/gpu_os_support.html\">AMD doesnâ€™t even recognize its own flagship GPUs as supported for ROCm</a>,\nwhich is mindboggling coming from NVIDIAâ€™s superior CUDA support.)</p>\n<hr />\n<p><a href=\"https://www.reddit.com/r/espadrine/comments/156bbmj/recomputing_gpu_performance/\">Comments on Reddit</a>.</p>\n<script type=\"application/ld+json\">\n{ \"@context\": \"http://schema.org\",\n  \"@type\": \"BlogPosting\",\n  \"datePublished\": \"2023-06-18T21:40:09Z\",\n  \"keywords\": \"gpu, ml\" }\n</script>\n",
      }
  ]
}
